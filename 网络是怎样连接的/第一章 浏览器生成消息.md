# 浏览器工作

#### 1. 浏览器解析网址并生成HTTP请求消息

浏览器是一个具备多种客户端功能的**综合性客户端软件**：

- 访问Web服务器：**HTTP**
- 上传和下载文件：**FTP**
- 读取本地文件：**FILE**
- 发送电子邮件：**mailto**

（*如果省略文件名，则访问默认文件index.html*）

HTTP消息主要包括两部分：**URI**（对什么）**+HTTP方法（GET、POST等）**（做什么）

![](E:\计算机网络\网络是怎样连接的\imgs\http_message.png)

（**消息头中定义了日期、支持的数据类型等头字段信息**）

HTTP的响应消息结构为：

**<HTTP版本><空格><状态码><空格><响应短语>**

#### 2. 浏览器向DNS服务器申请查询IP地址

​	1.  **IP地址：网络号+主机号**

​		IP地址内部结构由子网掩码标识，1标识网络号，0标识主机号（全0标识整个子网，全1标识所有设备）

 2. **Socket库与解析器**

    ​	Socket库是用于调用网络功能的程序组件集合，解析器通过**协议栈**向DNS服务器发送HTTP请求消息。

#### 3. DNS服务器的工作流程

 1. **从资源记录中查询**

    客户端的查询消息包括：**域名+class（一般为IN标识互联网）+记录类型**

    （记录类型为A表示**Web服务器**，MX表示**邮件服务器**等等）

2. **按域名层次结构存储**

   从**根域DNS**依次向下查询（根域DNS的IP地址存储在所有DNS服务器中）

3. 通过**缓存**加快DNS服务器的响应速度

#### :star:4. 委托协议栈发送消息

​	发送委托需要按照指定顺序调用Socket库中的程序组件，但实际仍需交给协议栈处理。

1. **创建套接字阶段socket**

   > <描述符> = socket(<使用IPv4>，<流模式>，...)
   >
   > 描述符是用来识别不同套接字的

2. **连接阶段connnect**

   > connect(<描述符>，<服务器的IP地址和端口号>，...)
   >
   > 当同时指定IP地址和端口号时，就可以明确识别出具体的套接字
   >
   > （Web是80号端口，电子邮件是25号端口）

3. **通信阶段**

   1. 数据准备：**write(<描述符>，<发送数据>，<发送数据长度>)**

   2. 接收消息：**<接收数据长度> = read(<描述符>，<接受数据缓冲区>)**

4. **断开阶段close**

   > close(<描述符>)：断开套接字，收发数据结束