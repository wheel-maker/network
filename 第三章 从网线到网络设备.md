# 从网线到网络设备

### 1. 信号在网线和集线器中传输

 - 每个网络包都是独立传输的，相互不干扰

 - 电信号在网线传输中会衰减，从而产生通信错误，双绞线能够抑制噪声

 - 集线器的工作原理：

   - RJ-45接口后的PHY模块接受信号

     > 使用MDI/MDI-X切换开关完成交叉接线，将接收信号与发送信号交换

   - 中继电路将信号广播给所有设备

### 2. 交换机的工作原理

​	![](E:\计算机网络\网络是怎样连接的\imgs\switches.png)

 1. **基本工作流程**

    > 每个端口相当于一块网卡，但是MAC模块不具有MAC地址

		- PHY模块接受并转换为通用格式
		- MAC模块将其转换为数字信息并进行FCS检验，置于缓存
		- 查找MAC地址表，确定端口，并将对应的交换电路导通

2. **MAC地址表的维护**
   1. 收到包，写入MAC地址表
   2. 不定时删除记录

3. **自动协商**：通过特定的连接脉冲信号发送支持的工作模式和传输速率

### 3. 路由器的工作原理

1. **基本工作过程**

   > 路由器由**转发模块**和**端口模块**组成，每个端口模块有独立的MAC地址和IP地址，并支持多种通信技术

2. **路由表的信息**

   ![](./imgs/route_table.png)

   - 路由器会忽略主机号，只匹配网络号
   - 路由表的子网掩码列只表示需要对比的比特数量
   - 跃点计数：表示距离目标IP地址的距离远近
   - 路由器对路由表的维护是与包转发操作相互独立的，通过路由器间的信息交换自行维护

3. **路由器转发操作**

   - 丢弃包的MAC头部
   - 查询路由表
     - 最长匹配原则（网络号）
     - 最小跃点数原则
     - 默认路由和丢弃（ICMP消息）

   - 包处理
     - 更新IP头部中的TTL字段
     - 根据端口MTU确认是否需要拆分包

4. **路由器发送操作**

   1. 添加MAC头部

      > 根据路由表的网关列判断地址，如果是IP地址，则需要通过ARP查询MAC地址

   2. 转换为电信号通过端口发送出去

5. **路由器与交换机**：IP与以太网的区别，IP委托以太网传输

### 4. 路由器的附加功能

1. **地址转换**

   1. 目的：内网中的设备使用私有地址无法和互联网直接收发，需要地址转换机制

   2. 原理：路由器将（私有地址+端口号）改写为（公有地址+端口号）记录
   3. 外网访问：需要手动添加私有地址到地址转换设备

2. **包过滤**

   通过事先设置的规则决定是否转发包（防火墙）

